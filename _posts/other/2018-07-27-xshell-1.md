---
layout: post
title: 解决跨域问题
date: 2018-07-27
tags: [other]
---

### 降域

对于主域相同的跨域比如a.domain-a.com和b.domain-a.com的主域都是都是domain-a.com，则可以通过js代码中设置以下代码来实现降域：

    document.domain = "domain-a.com"

这条语句执行之后，页面将会成功通过对       http://domain-a.com/dir/page.html 的同源检测。

这里需要注意的是，浏览器单独保存端口号，任何的赋值操作，包括document.domain=document.domain都会以null值覆盖掉原来的端口号。因此，domian-a.com:8080页面的脚本不能仅通过设置document.domian='domina-a.com'就能域domina-a.com通信。赋值时必须带上端口号，以确保端口号不会为null。


### 两个页面之间跨域通信

#### location.hash 跨域

假设域名domina-a.com下的文件cs1.html要和domain-b.com域名下的cs2.html传递信息。

1.cs1.html首先自动创建一个隐藏的iframe，iframe的src指向domian-b.com域名下的cs2.html页面。

2.cs2.html响应请求后再将通过修改cs1.html的hash值来传递数据。

3.同时在cs1.html上加上一个定时器，隔一段时间来判断location.hash的值有没有变化，一旦变化则获取hash值。

注意，由于两个页面不在同一个域下IE、Chrome不允许修改parent.location.hash的值，所以要借助域domain-a.com域名下的一个代理iframe。

缺点：location.hash会直接暴露在URL里，并且在一些浏览器里会产生厉害记录，数据安全性不高也影响用户体验。另外由于URL大小的限制，支持传递的数据量也不大，有些浏览器不支持onhashchange事件，需要轮询来获取URL的变化