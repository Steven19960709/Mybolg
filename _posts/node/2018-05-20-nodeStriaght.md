---
layout: post
title: node直出
date: 2018-05-20
tags: [node]
---

这里介绍一下关于node直出的相关知识。

### 基本概念

直出是什么？是怎样的性能优化？

首先，从用户输入url到站是最终页面的过程，可以简单分为以下几个部分：

- 用户输入url，开始拉去静态页面
- 静态页面加载完成后，解析文档标签，开始拉去CSS
- 开始拉去js文件
- js加载完成，执行js文件
- 将数据与资源渲染到页面

这种处理形式占据了很多情况，但是，不难发现，请求资源过多，依赖大，例如等待JS加载完成后执行时才会发起，数据请求，等待数据回来用户才能展示最终页面。这样会增加首屏渲染的消耗。

那么，这个时候就引出了数据直出了。

#### 数据直出

数据请求在server端提前获取，冰河HTML一同返回，页面模板和数据的渲染在浏览器端运行。

相对于第一种形式，第一点用户输入url时server端不会做其他处理直接返回HTML，在第四点向server请求获取数据。那么同样是向server请求数据，如果将第一点中将请求数据放在server中，将拿到的数据拼接到HTML上一并返回，那么可以减少在前端页面的一次数据请求时间。这就是数据直出的核心价值，处理方式如下：

- 用户输入url，在server返回HTML前去请求获取页面需要的数据
- 将数据拼接到HTML上并一起返回给前端,可以通过插入script标签将数据添加到全局变量上，或放到某个标签的data属性中例如：

        <body data=serverData = '{list: [1,2,3]}'>

- 在前端的JS代码中判断是否已经拿到服务端的数据，直接拿该数据进行页面渲染，不再做数据请求。

#### 直出（服务端渲染）

数据请求在server端提前获取，页面模板结合数据的渲染处理也在server上完成，输出最终的HTML。

第二种模式中依赖于js文件加载回来才能发起数据的请求挪用到server中，数据随着HTML一并返回，然后等待js文件加载完成，js将服务端已给到数据与HTML结合处理，生产最终页面的文档。

数据请求能够放在server上，对于数据与HTML结合处理也可以在server上做，从而减少等待JS文件的加载时间。这就是服务端渲染的核心。具体过程：

- server上获取数据并且将数据也页面模板结合，在服务端渲染成最终的HTML
- 返回最终的HTML展示

这样首页的展示不再需要等待JS文件回来，优化减少了这块时间

### 总结

直出能够将常用的模式优化到剩下了一次HTML请求，加快首屏渲染时间，使用服务端渲染，还能够有环前端渲染难以克服的SEO问题，而不管是简单的数据直出，还是服务端直出，都能使页面的性能优化得到较大提高。

在前后端没有分离时 使用后端渲染出模板的方式是与文中所述的直出方案效果是一致的，前后端分离后淡化了这种思想，Node 的发展让更多的前端开始做后端事情，直出的方式也越来越被重视了。

历史的车轮滚滚向前，直出方案看似回到了服务端渲染的原点，实际上是在以前的基础上盘旋上升。有了更多的能力，便可以有更多的思考。期待前端会越来越强大，这不，react-native也让前端开始着手客户端的事儿了 ~