---
layout: post
title: TCP协议
tags: [Interview,network]
---

这几天国庆假期，真的没有让自己停下来。。。都不知道自己怎样想的。。。明明是放假，就是不出去玩。。是我太懒了吗？？

于是我就找了一些坑一个一个填。今天就讲一下TCP协议的相关知识。

# Internet Introduction

互联网是由一整套协议构成的，TCP是其中的一个协议，有着自己的分工。

<img src="http://s8.51cto.com/wyfs02/M00/52/1F/wKiom1RkCCWTa_RqAAJf_qGuyAU502.jpg-wh_651x-s_1754659787.jpg">

    互联网协议，有五层，分别为应用层，传输层，网络层，连接层，实体层（数据链路层+物理层），越下面的层数越接近硬件，越上面的层数就越接近用户。

<img src="http://ovk2ylefr.bkt.clouddn.com/tcp.png">

<img src="http://s8.51cto.com/wyfs02/M01/52/1F/wKiom1RkCD2DRJ_lAAIRCC8B-nU958.jpg">

上面这张图中，Ethernet以太网是最底层的协议，它不能解决多个局域网通信的问题，于是又IP协议来解决。

IP(网络层）协议定义了一套自己的地址规则，称为IP地址。它实现了路由功能，允许某个局域网的A主机，向另外一个局域网的B主机发送消息。

但是IP协议只是一个地址协议，并不能保证数据包的完整，如果路由去丢包（例如缓存满，新进来的数据包就会丢失）。这个时候就需要发现丢了哪一个包，以及入股重新发送这个包，于是就要靠TCP协议了。

简单说，TCP 协议的作用是，保证数据通信的完整性和可靠性，防止丢包。

# TCP Introduction

TCP(Transmission Control Protocol 传输控制协议)是一种面向连接(连接导向)的、可靠的、 基于IP的传输层协议。TCP在IP报文的协议号是6。

## 重要字段

<img src="http://ovk2ylefr.bkt.clouddn.com/TCP2.png">

这张图听说是十分重要的，我就挑我感觉很重要的字段讲一讲。

- Source Port和Destination Port

分别占用16位，表示源端口号和目的端口号;用于区别主机中的不同进程， 而IP地址是用来区分不同的主机的，源端口号和目的端口号配合上IP首部中的源IP地址和目的IP地址就能唯一 的确定一个TCP连接;

- Sequence Number:

用来标识从TCP发端向TCP收端发送的数据字节流，它表示在这个报文段中的的第一个数据 字节在数据流中的序号;主要用来解决网络报乱序的问题;

- Acknowledgment Number

32位确认序列号包含发送确认的一端所期望收到的下一个序号，因此，确认序号应 当是上次已成功收到数据字节序号加1。不过，只有当标志位中的ACK标志(下面介绍)为1时该确认序列号的字 段才有效。主要用来解决不丢包的问题;

- TCP Flags:TCP首部中有6个标志比特，它们中的多个可同时被设置为1，主要是用于操控TCP的状态机的，依次 为URG，ACK，PSH，RST，SYN，FIN。我就说一下ACK，这个听得很多。

ACK: 这个标志表示应答域有效，就是说前面所说的TCP应答好将会包含在TCP数据包中，有两个取值，0和1，1表示有效，0无效。

## 三次握手

这个毋庸多说，肯定是很重要的，面试分分钟会问到。下面就讲一讲（虽然之前已经讲过，但是忘了）

